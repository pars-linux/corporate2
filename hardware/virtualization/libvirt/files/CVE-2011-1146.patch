--- src/libvirt.c.orig	2011-07-15 15:42:44.255923438 +0300
+++ src/libvirt.c	2011-07-15 15:49:49.770918211 +0300
@@ -3331,6 +3331,11 @@
         return (NULL);
     }
 
+    if (conn->flags & VIR_CONNECT_RO) {
+        virLibDomainError(conn, VIR_ERR_OPERATION_DENIED, __FUNCTION__);
+        goto error;
+    }
+
     if (nativeFormat == NULL || domainXml == NULL) {
         virLibConnError(conn, VIR_ERR_INVALID_ARG, __FUNCTION__);
         goto error;
@@ -9700,6 +9705,11 @@
         return (-1);
     }
 
+    if (dev->conn->flags & VIR_CONNECT_RO) {
+        virLibConnError(NULL, VIR_ERR_OPERATION_DENIED, __FUNCTION__);
+        goto error;
+    }
+
     if (dev->conn->driver->nodeDeviceDettach) {
         int ret;
         ret = dev->conn->driver->nodeDeviceDettach (dev);
@@ -9743,6 +9753,11 @@
         return (-1);
     }
 
+    if (dev->conn->flags & VIR_CONNECT_RO) {
+        virLibConnError(NULL, VIR_ERR_OPERATION_DENIED, __FUNCTION__);
+        goto error;
+    }
+
     if (dev->conn->driver->nodeDeviceReAttach) {
         int ret;
         ret = dev->conn->driver->nodeDeviceReAttach (dev);
@@ -9788,6 +9803,11 @@
         return (-1);
     }
 
+    if (dev->conn->flags & VIR_CONNECT_RO) {
+        virLibConnError(NULL, VIR_ERR_OPERATION_DENIED, __FUNCTION__);
+        goto error;
+    }
+
     if (dev->conn->driver->nodeDeviceReset) {
         int ret;
         ret = dev->conn->driver->nodeDeviceReset (dev);
@@ -13077,6 +13097,11 @@
 
     conn = snapshot->domain->conn;
 
+    if (conn->flags & VIR_CONNECT_RO) {
+        virLibConnError(conn, VIR_ERR_OPERATION_DENIED, __FUNCTION__);
+        goto error;
+    }
+
     if (conn->driver->domainRevertToSnapshot) {
         int ret = conn->driver->domainRevertToSnapshot(snapshot, flags);
         if (ret < 0)
@@ -13123,6 +13148,11 @@
 
     conn = snapshot->domain->conn;
 
+    if (conn->flags & VIR_CONNECT_RO) {
+          virLibConnError(conn, VIR_ERR_OPERATION_DENIED, __FUNCTION__);
+          goto error;
+     }
+
     if (conn->driver->domainSnapshotDelete) {
         int ret = conn->driver->domainSnapshotDelete(snapshot, flags);
         if (ret < 0)
