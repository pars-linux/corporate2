--- src/lib-mail/message-header-parser.c.orig	2011-05-20 15:27:39.903000082 +0300
+++ src/lib-mail/message-header-parser.c	2011-05-20 15:31:49.675000099 +0300
@@ -268,8 +268,11 @@
 		line->value_len = 0;
 
 		str_truncate(ctx->name, 0);
-		str_append_n(ctx->name, msg, size);
-		line->name = str_c(ctx->name);
+		/* use buffer_append() so the name won't be truncated if there
+          are NULs. */
+        buffer_append(ctx->name, msg, colon_pos);
+
+        line->name = str_c(ctx->name);
 		line->name_len = str_len(ctx->name);
 
 		line->middle = NULL;
