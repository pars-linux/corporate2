--- lib/saslutil.c	2006-03-13 19:26:36.000000000 +0100
+++ lib/saslutil.c.oden	2009-05-18 09:35:20.000000000 +0200
@@ -125,10 +125,12 @@ int sasl_encode64(const char *_in, unsig
     
     /* Will it fit? */
     olen = (inlen + 2) / 3 * 4;
-    if (outlen)
+    if (outlen) {
       *outlen = olen;
-    if (outmax < olen)
+    }
+    if (outmax <= olen) {
       return SASL_BUFOVER;
+    }
 
     /* Do the work... */
     blah=(char *) out;
@@ -151,8 +153,7 @@ int sasl_encode64(const char *_in, unsig
         *out++ = '=';
     }
 
-    if (olen < outmax)
-      *out = '\0';
+    *out = '\0';
     
     return SASL_OK;
 }
