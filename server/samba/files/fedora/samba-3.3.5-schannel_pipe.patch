From bc0dc5a452f52df76d3f6bbd119acd8476afe9d5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?G=C3=BCnther=20Deschner?= <gd@samba.org>
Date: Tue, 10 Nov 2009 13:10:12 +0100
Subject: [PATCH] s3-rpc_client: make sure cli_rpc_pipe_open_schannel() does not always return NT_STATUS_OK.

Guenther
(cherry picked from commit d241b9ae4c9b520406aac98e24d078f2d4fd4ae5)
---
 source3/rpc_client/cli_pipe.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/source3/rpc_client/cli_pipe.c b/source3/rpc_client/cli_pipe.c
index 9ff84f8..28d9d99 100644
--- a/source3/rpc_client/cli_pipe.c
+++ b/source3/rpc_client/cli_pipe.c
@@ -4123,6 +4123,8 @@ NTSTATUS cli_rpc_pipe_open_schannel(struct cli_state *cli,
 	struct rpc_pipe_client *result = NULL;
 	NTSTATUS status;
 
+	*presult = NULL;
+
 	status = get_schannel_session_key(cli, domain, &neg_flags,
 					  &netlogon_pipe);
 	if (!NT_STATUS_IS_OK(status)) {
@@ -4143,7 +4145,7 @@ NTSTATUS cli_rpc_pipe_open_schannel(struct cli_state *cli,
 		*presult = result;
 	}
 
-	return NT_STATUS_OK;
+	return status;
 }
 
 /****************************************************************************
-- 
1.6.5.2

