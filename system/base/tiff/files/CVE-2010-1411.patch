--- libtiff/tif_fax3.c.orig	2010-05-28 09:09:31.000000000 +0300
+++ libtiff/tif_fax3.c	2010-05-28 09:09:44.000000000 +0300
@@ -42,6 +42,7 @@
 #define	G3CODES
 #include "t4.h"
 #include <stdio.h>
+#include <stdint.h>
 
 /*
  * Compression+decompression state blocks are
@@ -491,10 +492,23 @@
 	    td->td_compression == COMPRESSION_CCITTFAX4
 	);
 
-	nruns = needsRefLine ? 2*TIFFroundup(rowpixels,32) : rowpixels;
+    uint64_t val64 = rowpixels;
+    if (needsRefLine)
+    {
+        val64 = 2 * (((val64 + 31) /32) * 32);
+        if (val64 > 0xffffffff)
+            return (0);
+    }
+    nruns = (val64 & 0xffffffff);
+    //nruns = needsRefLine ? 2*TIFFroundup(rowpixels,32) : rowpixels;
+
+    val64 = 2*(uint64_t)nruns+3;
+    if (val64 > 0xffffffff)
+        return (0);
+
+    dsp->runs = (uint32*) _TIFFCheckMalloc(tif, (val64 & 0xffffffff), sizeof (uint32),
+                                           "for Group 3/4 run arrays");
 
-	dsp->runs = (uint32*) _TIFFCheckMalloc(tif, 2*nruns+3, sizeof (uint32),
-					  "for Group 3/4 run arrays");
 	if (dsp->runs == NULL)
 		return (0);
 	dsp->curruns = dsp->runs;
