diff -Nuar php-5.2.14.orig/main/php_globals.h php-5.2.14/main/php_globals.h
--- php-5.2.14.orig/main/php_globals.h	2012-02-09 13:44:18.885000021 +0200
+++ php-5.2.14/main/php_globals.h	2012-02-09 15:21:46.729999920 +0200
@@ -162,6 +162,8 @@
 	long max_input_nesting_level;
 	zend_bool in_user_include;
 	zend_bool in_error_log;
+
+    long max_input_vars;
 };
 
 
diff -Nuar php-5.2.14.orig/main/php_variables.c php-5.2.14/main/php_variables.c
--- php-5.2.14.orig/main/php_variables.c	2012-02-09 13:44:18.883000021 +0200
+++ php-5.2.14/main/php_variables.c	2012-02-09 14:48:21.784000200 +0200
@@ -187,9 +187,14 @@
 				}
 				if (zend_symtable_find(symtable1, escaped_index, index_len + 1, (void **) &gpc_element_p) == FAILURE
 					|| Z_TYPE_PP(gpc_element_p) != IS_ARRAY) {
-					MAKE_STD_ZVAL(gpc_element);
-					array_init(gpc_element);
-					zend_symtable_update(symtable1, escaped_index, index_len + 1, &gpc_element, sizeof(zval *), (void **) &gpc_element_p);
+                    if (zend_hash_num_elements(symtable1) <= PG(max_input_vars)) {
+                        if (zend_hash_num_elements(symtable1) == PG(max_input_vars)) {
+                            php_error_docref(NULL TSRMLS_CC, E_ERROR, "Input variables exceeded %ld. To increase the limit change max_input_vars in php.ini.", PG(max_input_vars));
+                        }
+					    MAKE_STD_ZVAL(gpc_element);
+					    array_init(gpc_element);
+					    zend_symtable_update(symtable1, escaped_index, index_len + 1, &gpc_element, sizeof(zval *), (void **) &gpc_element_p);
+                    }
 				}
 				if (index != escaped_index) {
 					efree(escaped_index);
@@ -232,7 +237,14 @@
 				zend_symtable_exists(symtable1, escaped_index, index_len + 1)) {
 				zval_ptr_dtor(&gpc_element);
 			} else {
-				zend_symtable_update(symtable1, escaped_index, index_len + 1, &gpc_element, sizeof(zval *), (void **) &gpc_element_p);
+                if (zend_hash_num_elements(symtable1) <= PG(max_input_vars)) {
+                    if (zend_hash_num_elements(symtable1) == PG(max_input_vars)) {
+                        php_error_docref(NULL TSRMLS_CC, E_ERROR, "Input variables exceeded %ld. To increase the limit change max_input_vars in php.ini.", PG(max_input_vars));
+                    }
+				    zend_symtable_update(symtable1, escaped_index, index_len + 1, &gpc_element, sizeof(zval *), (void **) &gpc_element_p);
+                } else {
+                    zval_ptr_dtor(&gpc_element);
+                }
 			}
 			if (escaped_index != index) {
 				efree(escaped_index);
