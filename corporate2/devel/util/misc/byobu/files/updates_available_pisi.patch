--- usr/lib/byobu/updates_available.orig	2010-05-15 23:47:59.000000000 +0300
+++ usr/lib/byobu/updates_available	2010-06-23 11:18:16.409376043 +0300
@@ -21,12 +21,12 @@
 color 2>/dev/null || color() { true; }
 
 if [ "$1" = "--detail" -o "$1" = "--short" ]; then
-	if which apt-get >/dev/null; then
-		detail=`apt-get -s -o Debug::NoLocking=true upgrade`
+	if which pisi >/dev/null; then
+		detail=`python -c "import pisi; print pisi.api.list_upgradable()"`
 		if [ "$1" = "--detail" ]; then
 			printf "$detail"
 		else
-			short=`printf "$detail" | grep ^Inst | wc -l`
+			short=`python -c "import pisi; print len(pisi.api.list_upgradable())"`
 			printf "$short"
 		fi
 	fi
@@ -71,6 +71,9 @@
 		# If yum exists, use it
 		# TODO: We need a better way of counting updates available from a RH expert
 		yum list updates -q | egrep -v "Updated Packages" | wc -l > $mycache &
+	elif which pisi >/dev/null; then
+		# If pisi exists, use it
+		python -c "import pisi; print len(pisi.api.list_upgradable())" > $mycache &
 	fi
 }
 
@@ -87,7 +90,7 @@
 [ -r $mycache ] && print_updates `grep "^[0-9]" $mycache | sed "s/ .*$//"`
 
 # Update the cache if necessary
-if [ ! -e "$mycache" ] || [ "/var/lib/apt" -nt "$mycache" ] || [ "/var/lib/apt/lists" -nt "$mycache" ]; then
+if [ ! -e "$mycache" ] || [ "/var/lib/pisi" -nt "$mycache" ] || [ "/var/cache/pisi/packagedb.cache" -nt "$mycache" ]; then
 	# If apt is newer than mycache, background an update now
 	update_cache "$mycache"
 fi
