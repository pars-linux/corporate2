From 4640e1164f3dcf2a197ec9d35a30c77542f81daf Mon Sep 17 00:00:00 2001
From: Dan Williams <dcbw@redhat.com>
Date: Fri, 14 Jan 2011 14:02:02 -0600
Subject: [PATCH 104/122] core: lack of an IPv4 setting indicates DHCP (novell #664640)

It shouldn't assert.
---
 src/nm-device.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/src/nm-device.c b/src/nm-device.c
index e8f0b20..a14b5cb 100644
--- a/src/nm-device.c
+++ b/src/nm-device.c
@@ -3321,7 +3321,7 @@ dispose (GObject *object)
 	if (   nm_device_interface_can_assume_connections (NM_DEVICE_INTERFACE (self))
 	    && (nm_device_get_state (self) == NM_DEVICE_STATE_ACTIVATED)) {
 		NMConnection *connection;
-	    NMSettingIP4Config *s_ip4;
+	    NMSettingIP4Config *s_ip4 = NULL;
 		const char *method = NULL;
 
 		/* Only system connections can be left up */
@@ -3334,9 +3334,8 @@ dispose (GObject *object)
 			 * to check that.
 			 */
 			s_ip4 = (NMSettingIP4Config *) nm_connection_get_setting (connection, NM_TYPE_SETTING_IP4_CONFIG);
-			g_assert (s_ip4);
-
-			method = nm_setting_ip4_config_get_method (s_ip4);
+			if (s_ip4)
+				method = nm_setting_ip4_config_get_method (s_ip4);
 			if (   !method
 			    || !strcmp (method, NM_SETTING_IP4_CONFIG_METHOD_AUTO)
 			    || !strcmp (method, NM_SETTING_IP4_CONFIG_METHOD_MANUAL))
-- 
1.7.3.4

